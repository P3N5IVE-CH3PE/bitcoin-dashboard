<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitcoin Nowcasting Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        body {
            background: linear-gradient(to bottom right, #111827, #1f2937, #111827);
        }
        .signal-card {
            transition: transform 0.2s;
        }
        .signal-card:hover {
            transform: scale(1.05);
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .animate-spin {
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body class="min-h-screen text-white p-4">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="mb-6">
            <div class="flex items-center justify-between flex-wrap gap-4">
                <div>
                    <h1 class="text-3xl sm:text-4xl font-bold mb-2 flex items-center gap-3">
                        <svg class="text-orange-500" width="40" height="40" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M13 2L3 14h8l-1 8 10-12h-8l1-8z"/>
                        </svg>
                        Bitcoin Nowcasting Dashboard
                    </h1>
                    <p class="text-gray-400 text-sm">Real-time market intelligence detecting change as it happens</p>
                </div>
                <button onclick="fetchData()" id="refreshBtn" class="flex items-center gap-2 bg-orange-600 hover:bg-orange-700 px-4 py-2 rounded-lg transition">
                    <svg id="refreshIcon" width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M17.65 6.35A7.958 7.958 0 0012 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08A5.99 5.99 0 0112 18c-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
                    </svg>
                    Refresh
                </button>
            </div>
            <p id="lastUpdate" class="text-gray-500 text-xs mt-2"></p>
        </div>

        <!-- Error Message -->
        <div id="errorMsg" class="hidden bg-yellow-900 border border-yellow-600 rounded-lg p-4 mb-6">
            <p class="text-yellow-200"></p>
        </div>

        <!-- Loading -->
        <div id="loading" class="flex items-center justify-center py-20">
            <div class="text-center">
                <svg class="animate-spin mx-auto mb-4 text-orange-500" width="48" height="48" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M17.65 6.35A7.958 7.958 0 0012 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08A5.99 5.99 0 0112 18c-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
                </svg>
                <p class="text-xl text-gray-400">Loading Bitcoin data...</p>
            </div>
        </div>

        <!-- Main Content -->
        <div id="content" class="hidden">
            <!-- Price Card -->
            <div class="bg-gray-800 rounded-lg p-6 mb-6 shadow-2xl border border-gray-700">
                <div class="flex items-center justify-between flex-wrap gap-6">
                    <div>
                        <p class="text-gray-400 text-sm mb-1">Bitcoin Price (USD)</p>
                        <p id="btcPrice" class="text-4xl sm:text-5xl font-bold text-orange-400">$0</p>
                        <div class="flex items-center gap-2 mt-3">
                            <svg id="priceIcon" width="24" height="24" fill="currentColor" viewBox="0 0 24 24"></svg>
                            <span id="priceChange" class="text-xl font-semibold">0%</span>
                            <span class="text-gray-400 text-sm">24h</span>
                        </div>
                    </div>
                    <div id="overallSignal" class="px-6 py-4 rounded-lg shadow-lg">
                        <p class="text-sm opacity-80 mb-1">Overall Signal</p>
                        <p id="signalText" class="text-2xl sm:text-3xl font-bold">NEUTRAL</p>
                    </div>
                </div>
            </div>

            <!-- Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <div class="bg-gray-800 rounded-lg p-6 shadow-2xl border border-gray-700">
                    <h3 class="text-xl font-semibold mb-4">30-Day Price History</h3>
                    <div style="height: 300px;">
                        <canvas id="priceChart"></canvas>
                    </div>
                </div>
                <div class="bg-gray-800 rounded-lg p-6 shadow-2xl border border-gray-700">
                    <h3 class="text-xl font-semibold mb-4">Trading Volume</h3>
                    <div style="height: 300px;">
                        <canvas id="volumeChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Signals -->
            <div class="bg-gray-800 rounded-lg p-6 shadow-2xl border border-gray-700 mb-6">
                <h3 class="text-2xl font-semibold mb-6 flex items-center gap-2">
                    <svg class="text-yellow-500" width="28" height="28" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M13 2L3 14h8l-1 8 10-12h-8l1-8z"/>
                    </svg>
                    Nowcasting Signals
                </h3>
                <div id="signalsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
            </div>

            <!-- Info Box -->
            <div class="bg-blue-900 bg-opacity-30 border-2 border-blue-500 rounded-lg p-5">
                <div class="flex items-start gap-3">
                    <svg class="text-blue-400 flex-shrink-0 mt-1" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
                    </svg>
                    <div>
                        <h4 class="font-semibold text-blue-300 mb-2 text-lg">How This Works</h4>
                        <p class="text-sm text-gray-300 leading-relaxed">
                            This dashboard uses <strong>nowcasting principles</strong> to detect market changes as they happen. 
                            Instead of predicting the future, it analyzes real-time price action, volume, momentum, and market structure 
                            to identify what's happening <em>right now</em> before most traders notice.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="mt-8 text-center text-gray-500 text-xs sm:text-sm">
                <p>Data updates every 2 minutes • Powered by CoinGecko API</p>
                <p class="mt-2">⚠️ Not financial advice. Educational purposes only.</p>
            </div>
        </div>
    </div>

    <script>
        let priceChart, volumeChart;

        async function fetchData() {
            try {
                document.getElementById('refreshBtn').disabled = true;
                document.getElementById('refreshIcon').classList.add('animate-spin');
                
                const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd&include_24hr_change=true');
                const data = await response.json();
                
                const historyResponse = await fetch('https://api.coingecko.com/api/v3/coins/bitcoin/market_chart?vs_currency=usd&days=30&interval=daily');
                const historyData = await historyResponse.json();
                
                updateUI(data.bitcoin.usd, data.bitcoin.usd_24h_change, historyData);
                
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('content').classList.remove('hidden');
                document.getElementById('lastUpdate').textContent = 'Last updated: ' + new Date().toLocaleTimeString();
                
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('errorMsg').classList.remove('hidden');
                document.getElementById('errorMsg').querySelector('p').textContent = '⚠️ Could not fetch live data. Check your internet connection.';
            } finally {
                document.getElementById('refreshBtn').disabled = false;
                document.getElementById('refreshIcon').classList.remove('animate-spin');
            }
        }

        function updateUI(price, change, historyData) {
            // Update price
            document.getElementById('btcPrice').textContent = '$' + price.toLocaleString();
            
            // Update price change
            const priceChangeEl = document.getElementById('priceChange');
            priceChangeEl.textContent = (change >= 0 ? '+' : '') + change.toFixed(2) + '%';
            priceChangeEl.className = `text-xl font-semibold ${change >= 0 ? 'text-green-500' : 'text-red-500'}`;
            
            // Update icon
            const icon = document.getElementById('priceIcon');
            if (change >= 0) {
                icon.innerHTML = '<path d="M7 14l5-5 5 5z"/>';
                icon.className = 'text-green-500';
            } else {
                icon.innerHTML = '<path d="M7 10l5 5 5-5z"/>';
                icon.className = 'text-red-500';
            }
            
            // Process history
            const prices = historyData.prices.slice(-30);
            const volumes = historyData.total_volumes.slice(-30);
            const labels = prices.map(p => new Date(p[0]).toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
            const priceValues = prices.map(p => p[1]);
            const volumeValues = volumes.map(v => v[1] / 1000000);
            
            // Generate signals
            generateSignals(change, priceValues, volumeValues);
            
            // Update charts
            updateCharts(labels, priceValues, volumeValues);
        }

        function generateSignals(change, prices, volumes) {
            const signals = [];
            let bullish = 0, bearish = 0;
            
            // Price Momentum
            if (change > 5) {
                signals.push({ name: 'Price Momentum', status: 'BULLISH', strength: 'Strong', desc: 'Strong upward momentum' });
                bullish += 2;
            } else if (change > 2) {
                signals.push({ name: 'Price Momentum', status: 'BULLISH', strength: 'Moderate', desc: 'Moderate upward momentum' });
                bullish += 1;
            } else if (change < -5) {
                signals.push({ name: 'Price Momentum', status: 'BEARISH', strength: 'Strong', desc: 'Strong downward momentum' });
                bearish += 2;
            } else if (change < -2) {
                signals.push({ name: 'Price Momentum', status: 'BEARISH', strength: 'Moderate', desc: 'Moderate downward momentum' });
                bearish += 1;
            } else {
                signals.push({ name: 'Price Momentum', status: 'NEUTRAL', strength: 'Weak', desc: 'Consolidating' });
            }
            
            // Volume Analysis
            const recentVol = volumes.slice(-3).reduce((a, b) => a + b, 0) / 3;
            const prevVol = volumes.slice(-10, -3).reduce((a, b) => a + b, 0) / 7;
            
            if (recentVol > prevVol * 1.3) {
                signals.push({ name: 'Volume Surge', status: 'BULLISH', strength: 'Strong', desc: 'Accumulation detected' });
                bullish += 2;
            } else if (recentVol < prevVol * 0.7) {
                signals.push({ name: 'Volume Decline', status: 'BEARISH', strength: 'Moderate', desc: 'Low participation' });
                bearish += 1;
            } else {
                signals.push({ name: 'Volume', status: 'NEUTRAL', strength: 'Normal', desc: 'Normal activity' });
            }
            
            // Trend Strength
            const avg7 = prices.slice(-7).reduce((a, b) => a + b, 0) / 7;
            const avg30 = prices.reduce((a, b) => a + b, 0) / 30;
            const diff = ((avg7 - avg30) / avg30) * 100;
            
            if (diff > 5) {
                signals.push({ name: 'Trend Strength', status: 'BULLISH', strength: 'Strong', desc: 'Strong uptrend' });
                bullish += 2;
            } else if (diff < -5) {
                signals.push({ name: 'Trend Strength', status: 'BEARISH', strength: 'Strong', desc: 'Strong downtrend' });
                bearish += 2;
            } else {
                signals.push({ name: 'Trend', status: 'NEUTRAL', strength: 'Weak', desc: 'Range-bound' });
            }
            
            // Volatility
            const recent = prices.slice(-7);
            const volatility = ((Math.max(...recent) - Math.min(...recent)) / Math.min(...recent)) * 100;
            
            if (volatility > 15) {
                signals.push({ name: 'High Volatility', status: 'CAUTION', strength: 'High', desc: 'Trade carefully' });
                bearish += 1;
            } else if (volatility < 5) {
                signals.push({ name: 'Low Volatility', status: 'NEUTRAL', strength: 'Low', desc: 'Big move coming' });
            } else {
                signals.push({ name: 'Volatility', status: 'NORMAL', strength: 'Normal', desc: 'Normal volatility' });
            }
            
            // Market Structure
            const recentHigh = Math.max(...prices.slice(-3));
            const prevHigh = Math.max(...prices.slice(-10, -3));
            
            if (recentHigh > prevHigh * 1.02) {
                signals.push({ name: 'Market Structure', status: 'BULLISH', strength: 'Strong', desc: 'Higher highs' });
                bullish += 1;
            } else if (recentHigh < prevHigh * 0.98) {
                signals.push({ name: 'Market Structure', status: 'BEARISH', strength: 'Strong', desc: 'Lower highs' });
                bearish += 1;
            } else {
                signals.push({ name: 'Market Structure', status: 'NEUTRAL', strength: 'Normal', desc: 'Sideways' });
            }
            
            // Overall signal
            let overall = 'NEUTRAL';
            if (bullish > bearish + 2) overall = 'STRONG BUY';
            else if (bullish > bearish) overall = 'BUY';
            else if (bearish > bullish + 2) overall = 'STRONG SELL';
            else if (bearish > bullish) overall = 'SELL';
            
            updateSignals(signals, overall);
        }

        function updateSignals(signals, overall) {
            const grid = document.getElementById('signalsGrid');
            grid.innerHTML = signals.map(s => {
                const colors = {
                    BULLISH: 'text-green-400 bg-green-900 border-green-500',
                    BEARISH: 'text-red-400 bg-red-900 border-red-500',
                    CAUTION: 'text-yellow-400 bg-yellow-900 border-yellow-500',
                    NEUTRAL: 'text-gray-400 bg-gray-700 border-gray-500',
                    NORMAL: 'text-blue-400 bg-blue-900 border-blue-500'
                };
                return `
                    <div class="signal-card rounded-lg p-4 border-2 ${colors[s.status]}">
                        <div class="flex justify-between mb-2">
                            <h4 class="font-semibold">${s.name}</h4>
                            <span class="text-xs font-bold">${s.status}</span>
                        </div>
                        <p class="text-xs opacity-80 mb-1">Strength: ${s.strength}</p>
                        <p class="text-sm opacity-90">${s.desc}</p>
                    </div>
                `;
            }).join('');
            
            const signalEl = document.getElementById('overallSignal');
            const signalColors = overall.includes('BUY') ? 'bg-green-600' : overall.includes('SELL') ? 'bg-red-600' : 'bg-gray-600';
            signalEl.className = `px-6 py-4 rounded-lg shadow-lg ${signalColors} text-white`;
            document.getElementById('signalText').textContent = overall;
        }

        function updateCharts(labels, prices, volumes) {
            if (priceChart) priceChart.destroy();
            if (volumeChart) volumeChart.destroy();
            
            const ctx1 = document.getElementById('priceChart').getContext('2d');
            priceChart = new Chart(ctx1, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Price (USD)',
                        data: prices,
                        borderColor: '#FB923C',
                        backgroundColor: 'rgba(251, 146, 60, 0.1)',
                        borderWidth: 2,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    aspectRatio: 2,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { ticks: { color: '#9CA3AF' }, grid: { color: '#374151' } },
                        x: { ticks: { color: '#9CA3AF', maxRotation: 45, minRotation: 45 }, grid: { color: '#374151' } }
                    }
                }
            });
            
            const ctx2 = document.getElementById('volumeChart').getContext('2d');
            volumeChart = new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Volume (M)',
                        data: volumes,
                        backgroundColor: '#3B82F6'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    aspectRatio: 2,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { ticks: { color: '#9CA3AF' }, grid: { color: '#374151' } },
                        x: { ticks: { color: '#9CA3AF', maxRotation: 45, minRotation: 45 }, grid: { color: '#374151' } }
                    }
                }
            });
        }

        // Initial load
        fetchData();
        
        // Auto-refresh every 2 minutes
        setInterval(fetchData, 120000);
    </script>
</body>
</html>
